#!/bin/bash
set -eu

run() {
    echo >&2 "+ $*"
    "$@"
}

trap 'echo ERROR' EXIT

run systemsetup -setremotelogin on

# SSH key doesn't exist until we hit the SSH server for the first time
nc -z localhost 22

if ! which sixword >/dev/null; then
    run sudo gem install sixword
fi

echo "Potential IP addresses:"
for i in $(seq 0 "$(ipconfig ifcount)"); do
    if="en$i"
    echo "$if: $(ipconfig getifaddr "$if")"
done

echo "SSH key fingerprint:"
ssh-keygen -lf /etc/ssh_host_rsa_key.pub | cut -d' ' -f2 | sixword -H

trap - EXIT
